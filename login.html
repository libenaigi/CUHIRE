<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login - CUHIRE</title>
    <link rel="stylesheet" href="css/login.css" />
    <style>
      .tab-selector button.active {
        background: #0a0a23;
        color: white;
      }
      /* Other styles for logo, header etc. */
    </style>
  </head>
  <body>
    <header class="header"></header>

    <section class="form-container">
      <h2>Welcome Back</h2>
      <p>Sign in to your account to continue</p>

      <div class="tab-selector">
        <button class="active" data-role="jobseeker">Job Seeker</button>
        <button data-role="recruiter">Recruiter</button>
        <button data-role="admin">Admin</button>
      </div>

      <form class="login-form" id="loginForm">
        <label>Email Address</label>
        <input type="email" id="email" placeholder="you@example.com" required />

        <label>Password</label>
        <input
          type="password"
          id="password"
          placeholder="********"
          required
        />

        <div class="form-options">
          <label><input type="checkbox" /> Remember me</label>
          <a href="#">Forgot password?</a>
        </div>

        <button type="submit">Sign In</button>

        <p class="form-footer">
          Don't have an account? <a href="signup.html">Sign up</a>
        </p>
      </form>
    </section>

    <footer class="footer">
      <div class="container footer-grid">
        <div class="footer-col">
          <div class="footer-logo">
            <img
              src="images/logo.png"
              alt="CUHIRE Logo"
              class="footer-logo-img"
            />
            <span>CUHIRE</span>
          </div>
          <p>
            Connecting talent with opportunity. Find your dream job or the
            perfect candidate.
          </p>
          <div class="socials">
            <a href="#">üê¶</a>
            <a href="#">üìò</a>
            <a href="#">üì∏</a>
            <a href="#">üîó</a>
          </div>
        </div>
        <div class="footer-col">
          <h4>For Job Seekers</h4>
          <ul>
            <li><a href="jobportal.html">Browse Jobs</a></li>
            <li><a href="dashboard.html">Dashboard</a></li>
            <li><a href="#">Applications</a></li>
            <li><a href="account.html">Profile Settings</a></li>
          </ul>
        </div>
        <div class="footer-col">
          <h4>For Recruiters</h4>
          <ul>
            <li><a href="post-job.html">Post a Job</a></li>
            <li><a href="recruiter-dashboard.html">Dashboard</a></li>
            <li><a href="#">Pricing</a></li>
            <li><a href="#">Resources</a></li>
          </ul>
        </div>
        <div class="footer-col">
          <h4>Company</h4>
          <ul>
            <li><a href="#">About Us</a></li>
            <li><a href="#">Contact</a></li>
            <li><a href="#">Privacy Policy</a></li>
            <li><a href="#">Terms of Service</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">&copy; 2025 CUHIRE. All rights reserved.</div>
    </footer>

    <script>
      let selectedRole = "jobseeker"; // Default role

      // Tab selection logic
      const tabs = document.querySelectorAll(".tab-selector button");
      tabs.forEach((tab) => {
        tab.addEventListener("click", () => {
          tabs.forEach((t) => t.classList.remove("active"));
          tab.classList.add("active");
          selectedRole = tab.dataset.role.trim().toLowerCase();
        });
      });

      // Login form submission logic
      document
        .getElementById("loginForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const email = document.getElementById("email").value.trim();
          const password = document.getElementById("password").value.trim();

          // Debug log on the client-side
          console.log("Sending to backend:", {
            email,
            password,
            role: selectedRole,
          });

          try {
            const res = await fetch("https://cuhire-4.onrender.com/api/auth/login", { // <-- THIS LINE IS UPDATED
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                email,
                password,
                role: selectedRole,
              }),
            });

            const data = await res.json();
            console.log("Received from backend:", data); // Log response

            if (res.ok) {
              localStorage.setItem("token", data.token);
              localStorage.setItem("role", data.user.role); // Store the role from response
              alert("Login successful!");
              // Redirect based on role or to a generic dashboard
              window.location.href = "dashboard.html";
            } else {
              alert(data.message || "Login failed. Check credentials.");
            }
          } catch (err) {
            console.error("Login submission error:", err);
            alert("A server error occurred. Please try again later.");
          }
        });
    </script>
  </body>
</html>
